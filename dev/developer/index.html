<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer · ReferenceFiniteElements.jl</title><meta name="title" content="Developer · ReferenceFiniteElements.jl"/><meta property="og:title" content="Developer · ReferenceFiniteElements.jl"/><meta property="twitter:title" content="Developer · ReferenceFiniteElements.jl"/><meta name="description" content="Documentation for ReferenceFiniteElements.jl."/><meta property="og:description" content="Documentation for ReferenceFiniteElements.jl."/><meta property="twitter:description" content="Documentation for ReferenceFiniteElements.jl."/><meta property="og:url" content="https://cthonios.github.io/ReferenceFiniteElements.jl/developer/"/><meta property="twitter:url" content="https://cthonios.github.io/ReferenceFiniteElements.jl/developer/"/><link rel="canonical" href="https://cthonios.github.io/ReferenceFiniteElements.jl/developer/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../installation/">ReferenceFiniteElements.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Home</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../quick_start/">Quick start</a></li><li><a class="tocitem" href="../storage_types/">Storage types</a></li></ul></li><li><a class="tocitem" href="../extensions/">Extensions</a></li><li class="is-active"><a class="tocitem" href>Developer</a></li><li><a class="tocitem" href="../">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Developer</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developer</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Cthonios/ReferenceFiniteElements.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Cthonios/ReferenceFiniteElements.jl/blob/main/docs/src/developer.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-add-a-new-element-type"><a class="docs-heading-anchor" href="#How-to-add-a-new-element-type">How to add a new element type</a><a id="How-to-add-a-new-element-type-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-add-a-new-element-type" title="Permalink"></a></h1><p>To add a new finite element there&#39;s a few things we need to do. First, we may need to define an abstract type if the element type is not a currently supported abstract element topology. The currently supported abstract element topologies are   </p><ul><li><code>AbstractEdge</code></li><li><code>AbstractHex</code></li><li><code>AbstractQuad</code></li><li><code>AbstractTet</code></li><li><code>AbstractTri</code></li></ul><p>We&#39;ll use a <code>Tri3</code> element as an example of how to add a new element type.</p><p>First, let&#39;s pretend <code>AbstractTri</code> doesn&#39;t exist yet. The first thing we need to do is define the following abstract type</p><pre><code class="language-julia hljs">abstract type AbstractTri{N, D, Q} &lt;: RefenceFEType{N, D, Q} end</code></pre><p>The three parameters <code>N</code>, <code>D</code>, and <code>Q</code> are the number of nodes, the number of dimensions, and the number of quadrature points for an element implementation. For a given element topology, such as a three noded triangle in this example, <code>N</code> and <code>D</code> will be fixed parameters while we allow for <code>Q</code> to be variable, i.e. have potentially different quadrature rules on the element. </p><p>Now we define a struct for specific implementations. Here we&#39;ll define the Tri3 struct.</p><pre><code class="language-julia hljs">struct Tri3{Q} &lt;: AbstractTri{3, 2, Q}
  degree::Int
end</code></pre><p>Here we have fixed <code>N</code> and <code>D</code> to be <code>3</code> and <code>2</code> respectively while <code>Q</code> is left as a parametric type. The struct has one field, <code>degree</code>, which denotes the degree of the quadrature rule. Other element rules could have more parameters depending upon how interpolation and integration are performed. </p><p>We can also define some type stable constructors for different quadrature degrees. This look like the following</p><pre><code class="language-julia hljs">Tri3(::Val{1}) = Tri3{1}(1)
Tri3(::Val{2}) = Tri3{3}(2)</code></pre><p>for quadrature degrees of <code>1</code> and <code>2</code> respectively. The numbers <code>1</code> and <code>3</code> correspond to the number of quadrature points in each rule.</p><p>Now that we have a basic type to represent our element topology defined, there&#39;s a few methods we need to define for setup purposes. These methods are</p><ul><li><code>quadrature_points_and_weights</code></li><li><code>element_stencil</code></li><li><code>shape_function_values</code></li><li><code>shape_funciton_gradients</code></li><li><code>shape_function_hessians</code></li></ul><p>Below is the implementaiton of <code>element_stencial</code> for <code>AbstractTri</code> elements</p><pre><code class="language-julia hljs">function quadrature_points_and_weights(e::E, ::Type{A}, ::Type{T}) where {
  A &lt;: Union{SVector, MVector}, T &lt;: Number, E &lt;: AbstractTri
}

  D = num_dimensions(e)

  if degree(e) == 1
    ξs    = Vector{A{D, T}}(undef, 1)
    ξs[1] = A{D, T}(1. / 3., 1. / 3.)
    ws    = T[0.5]
  elseif degree(e) == 2
    ξs    = Vector{A{D, T}}(undef, 3)
    ξs[1] = A{D, T}(2. / 3., 1. / 6.)
    ξs[2] = A{D, T}(1. / 6., 2. / 3.)
    ξs[3] = A{D, T}(1. / 6., 1. / 6.)
    ws    = T[1. / 6., 1. / 6., 1. / 6.]
  end
  return ξs, ws
end</code></pre><p>Two different quadature rules, <code>degree = 1</code> and <code>degree = 2</code> are supported. The <code>degree = 1</code> case we could refer to as &quot;fully integrated.&quot;</p><p>The implementation of <code>element_stencil</code> for <code>Tri3</code> elements is shown below</p><pre><code class="language-julia hljs">function element_stencil(::Tri3, ::Type{Itype}, ::Type{Ftype}) where {Itype &lt;: Integer, Ftype &lt;: AbstractFloat}
  nodal_coordinates = Ftype[
    0.0 1.0 0.0;
    0.0 0.0 1.0
  ]
  edge_nodes = Itype[
    1 2 3
    2 3 1
  ]
  face_nodes = Itype[;;]
  interior_nodes = Vector{Itype}(undef, 0)
  return nodal_coordinates, edge_nodes, face_nodes, interior_nodes
end</code></pre><p>The implementation of <code>shape_function_values</code> for <code>Tri3</code> elements is shown below</p><pre><code class="language-julia hljs">function shape_function_values(e::Tri3, ::Type{A1}, ξ::A2) where {
  A1 &lt;: Union{SVector, MVector}, A2 &lt;: AbstractArray{&lt;:Number, 1}
}
  N = A1{num_nodes(e), eltype(ξ)}(
    1. - ξ[1] - ξ[2],
    ξ[1],
    ξ[2]
  )
end</code></pre><p>The implementation of <code>shape_function_gradients</code> for <code>Tri3</code> elements is shown below</p><pre><code class="language-julia hljs">function shape_function_gradients(e::Tri3, ::Type{A1}, ξ::A2) where {
  A1 &lt;: Union{SMatrix, MMatrix}, A2 &lt;: AbstractArray{&lt;:Number, 1}
}
  ∇N_ξ = A1{num_nodes(e), num_dimensions(e), eltype(ξ), num_nodes(e) * num_dimensions(e)}(
    -1., 1., 0.,
    -1., 0., 1.
  )
end</code></pre><p>The implementation of <code>shape_function_hessians</code> for <code>Tri3</code> elements is shown below</p><pre><code class="language-julia hljs">function shape_function_hessians(e::Tri3, ::Type{A1}, ξ::A2) where {
  A1 &lt;: Union{SArray, MArray}, A2 &lt;: AbstractArray{&lt;:Number, 1}
}
  N, D = num_nodes(e), num_dimensions(e)
  ∇∇N_ξ = zeros(A1{Tuple{N, D, D}, eltype(ξ), 3, N * D * D})
end</code></pre><p>As a convention, all of the interpolation methods for every element type are defined with <code>StaticArrays</code> as the default array type. Internally, when other array types are requested, these arrays are converted to the requested type. This allows for allocations on setup only for those array types that require it. </p><p>Another thing to note is for all existing elements defined in the package, the <code>quadrature_points_and_weights</code> method is defined on abstract types. This could change in the future, but is the current convention. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../extensions/">« Extensions</a><a class="docs-footer-nextpage" href="../">Index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 5 February 2024 22:05">Monday 5 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
